<div layout:fragment="content" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
     xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
     layout:decorate="~{/layout-launchpad}"
     th:if="${#bools.isTrue(@environment.getProperty('aiai.launchpad.enabled'))}"
     sec:authorize="isAuthenticated()"
>

    <!--/*@thymesVar id="result" type="aiai.ai.launchpad.experiment.ExperimentsController.SequencesResult"*/-->
    <!--/*@thymesVar id="experiment" type="aiai.ai.beans.Experiment"*/-->
    <!--/*@thymesVar id="feature" type="aiai.ai.beans.ExperimentFeature"*/-->
    <!--/*@thymesVar id="consoleResult" type="aiai.ai.launchpad.experiment.ExperimentsController.ConsoleResult"*/-->

    <script>
        var table = function (html) {
            var html1 = $('#fragment-table').html(html);

            html1.find('.ajax-elem').each(function () {
                $(this).click(function () {
                    $( '#fragment-console-table' ).empty();
                    $.post($(this).attr('href'), table);
                    return false;
                });
            });

            html1.find('.ajax-elem-console').each(function () {
                $(this).click(function () {
                    $.post( $(this).attr('href'), function( data ) {
                        $( '#fragment-console-table' ).empty().append( data );
                    });
                    return false;
                });
            });
        };

        $(function () {
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");

            $(document).ajaxSend(function (e, xhr, options) {
                xhr.setRequestHeader(header, token);
            });

            $.post('/launchpad/experiment-feature-progress-part/' + [[${experiment.id}]] + '/' + [[${feature.id}]], table);
        });
    </script>



    <h1 class="widget-header">The experiment info</h1>

    <h1 class="widget-header">General info</h1>
    <table class="pure-table pure-table-bordered">
        <tbody>
        <tr><td>#Id</td><td  th:text="${feature.id}">#Id</td></tr>
        <tr><td>Feature ids</td><td th:text="${feature.featureIds}">featureIds</td></tr>
        <tr><td>Is in progress?</td><td th:text="${feature.isInProgress}">isInProgress</td></tr>
        <tr><td>Is in finished?</td><td th:text="${feature.isFinished}">isFinished</td></tr>
        <tr><td>Exec status</td><td th:text="${feature.execStatusAsString()}">Exec status</td></tr>
        </tbody>
    </table>
    <p>&nbsp;</p>

    <table>
        <tr valign="top">
            <td>
                <h1 class="widget-header">Sequences</h1>
                <table class="pure-table pure-table-bordered" id="fragment-table" th:fragment="fragment-table">
                    <thead>
                    <tr>
                        <th>Id</th>
                        <th>Is completed?</th>
                        <th>Is all snippets Ok?</th>
                        <th>Date</th>
                        <th colspan="1">&nbsp;</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:each="s : ${result.items}" valign="top">
                        <td th:text="${s.id}">Sequence Id</td>
                        <td th:text="${s.isCompleted}">isCompleted</td>
                        <td th:text="${s.isAllSnippetsOk}">isAllSnippetsOk</td>
                        <td>
                            <table>
                                <tr><td th:text="${'assigned: ' + #dates.format(s.assignedOn, 'dd-MMM-yy HH:mm')}">assigned on></tr>
                                <tr><td th:text="${'completed: ' + #dates.format(s.completedOn, 'dd-MMM-yy HH:mm')}">completed on></tr>
                            </table>
                        </td>
                        <td>
                            <a class='ajax-elem-console table-nav-button pure-button prev' href="#"
                               th:href="@{/launchpad/experiment-feature-progress-console-part/{id}/(id=${s.id})}"
                               title='Console output'>Info</a>
                    </tr>
                    <tr>
                        <td colspan="6">
                            <div th:if="${feature!=null and experiment!=null}">
                                <ul class='pagination pagination-centered'>
                                    <li class="table-nav-padding">
                                        <span th:if='${result.items.first}' class="table-nav-button">« First</span>
                                        <a class='ajax-elem table-nav-button pure-button prev' href="#" th:if='${not result.items.first}'
                                           th:href="@{/launchpad/experiment-feature-progress-part/{experimentId}/{featureId}(experimentId=${experiment.id},featureId=${feature.id},page=0,size=${result.items.pageable.pageSize})}">« First</a>
                                    </li>
                                    <li class="table-nav-padding">
                                        <span th:if='${not result.items.hasPrevious()}' class="table-nav-button">←</span>
                                        <a class='ajax-elem table-nav-button pure-button prev' href="#" th:if='${result.items.hasPrevious()}'
                                           th:href="@{/launchpad/experiment-feature-progress-part/{experimentId}/{featureId}(experimentId=${experiment.id},featureId=${feature.id},page=${result.items.pageable.pageNumber - 1},size=${result.items.pageable.pageSize})}" title='Go to previous page'>←</a>
                                    </li>
                                    <li class="table-nav-padding">
                                        <span th:if='${not result.items.hasNext()}' class="table-nav-button">→</span>
                                        <a class='ajax-elem table-nav-button pure-button prev' href="#" th:if='${result.items.hasNext()}'
                                           th:href="@{/launchpad/experiment-feature-progress-part/{experimentId}/{featureId}(experimentId=${experiment.id},featureId=${feature.id},page=${result.items.pageable.pageNumber + 1},size=${result.items.pageable.pageSize})}" title='Go to next page'>→</a>
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <p>&nbsp;</p>

                <a class="pure-button pure-button-primary" href="experiment-info.html" th:href="${'/launchpad/experiment-info/' + experiment.id }">To experiment info</a>

            </td>
            <td width="20">&nbsp;</td>
            <td>
                <h1 class="widget-header">Console output</h1>
                <table class="pure-table pure-table-bordered" id="fragment-console-table" th:fragment="fragment-console-table">
                    <tbody>
                    <div  th:remove="tag" th:each="c : ${consoleResult.items}" >
                        <tr><td th:text="${'#'+c.order}">Order number</td></tr>
                        <tr><td><pre th:text="${c.console}">console output</pre></td></tr>
                    </div>
                    </tbody>
                </table>
            </td>
        </tr>
    </table>


</div>