<div layout:fragment="content" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
     layout:decorate="~{/layout-launchpad}"
     th:if="${#bools.isTrue(@environment.getProperty('aiai.launchpad.enabled'))}"
>

    <!--/*@thymesVar id="result" type="aiai.ai.launchpad.dataset.DatasetsController.DatasetDefinition"*/-->

    <h2 class="widget-header">Groups and Columns</h2>
    <form class="pure-form pure-form-stacked" th:object="${result.dataset}" method="post" action="#" th:method="POST" th:action="@{/launchpad/dataset-definition-form-commit}" accept-charset="UTF-8"
          id="dataset-form" name="f">
        <input type="hidden" th:field="*{id}"/>
        <input type="hidden" th:field="*{version}"/>
        <fieldset>

            <label for="description">Description</label>
            <input name="description" id="description" type="text" placeholder="description" th:field="*{description}">
            <span class="pure-form-message">This is a required field.</span>

        </fieldset>
        <p></p>
        <button type="submit" class="pure-button pure-button-primary">Save changes</button>
    </form>

    <p></p>
    <p></p>
    <h2 class="widget-header">Groups and Columns</h2>

    <a class="pure-button pure-button-primary" href="#" th:href="${'/launchpad/dataset-group-add-new/'+result.dataset.id}">Add group record</a>
    <p></p>
    <form class="pure-form pure-form-stacked" method="post" action="#" th:method="POST" th:action="@{/launchpad/dataset-header-commit}"
          accept-charset="UTF-8" th:id="'dataset-header-form'" name="f">
        <input type="hidden" th:name="id" th:value="${result.dataset.id}"/>
        <input type="hidden" th:name="version" th:value="${result.dataset.version}"/>
        Is the first row the header:&nbsp;<input name="header" id="header" type="checkbox" placeholder="checkbox" th:checked="${result.dataset.header}"
                                th:onclick="'document.getElementById(\'dataset-header-form\').submit();'">
    </form>
    <p></p>

    <div th:if='${result.dataset.datasetGroups.isEmpty()}'>
        <p>There isn't any group</p>
    </div>

    <table class="pure-table pure-table-bordered" id="table-ds-groups" th:fragment="table" th:if='${not result.dataset.datasetGroups.isEmpty()}'>
        <thead>
        <tr>
            <th>Group Id</th>
            <th>Is skip this group</th>
            <th>Actions</th>
            <th>Columns</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="g,gIterStatus : ${result.dataset.datasetGroups}">
            <td>
                <p th:text="${'Group #' + g.groupNumber}">#Id</p>
            </td>
            <td>
                <form th:if="${ not g.feature}" class="pure-form pure-form-stacked" method="post" action="#" th:method="POST" th:action="@{/launchpad/dataset-group-skip-commit}" accept-charset="UTF-8"
                      th:id="${'dataset-group-form-'+g.id}" name="f">
                    <input type="hidden" th:name="id" th:value="${g.id}"/>
                    <input type="hidden" th:name="version" th:value="${g.version}"/>
                    Is skip:&nbsp;<input name="skip" id="skip" type="checkbox" placeholder="checkbox" th:checked="${g.skip}"
                                         th:onclick="'document.getElementById(\'dataset-group-form-'+${g.id}+'\').submit();'">
                </form>
                <form th:if="${gIterStatus.last}" class="pure-form pure-form-stacked" method="post" action="#" th:method="POST" th:action="@{/launchpad/dataset-group-feature-commit}"
                      accept-charset="UTF-8" th:id="${'dataset-group-feature-form-'+g.id}" name="f">
                    <input type="hidden" th:name="id" th:value="${g.id}"/>
                    <input type="hidden" th:name="version" th:value="${g.version}"/>
                    Is feature:&nbsp;<input name="feature" id="feature" type="checkbox" placeholder="checkbox" th:checked="${g.feature}"
                                            th:onclick="'document.getElementById(\'dataset-group-feature-form-'+${g.id}+'\').submit();'">
                </form>
            </td>
            <td>
                <a class="pure-button pure-button-primary" href="dataset-column-form.html" th:href="${'/launchpad/dataset-column-add/' + g.id}" th:if='${g.isAddColumn()}'>Add column</a>
                <a class="pure-button pure-button-primary" href="#" th:href="${'/launchpad/dataset-delete-group/' + g.id}" th:if='${g.datasetColumns.isEmpty()}'>Delete group</a>
            </td>
            <td>
                <table class="pure-table pure-table-bordered" id="table-ds-group-cols" th:fragment="table" th:if='${not result.dataset.datasetGroups.isEmpty()}'>
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th colspan="3">&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="r,rIterStatus : ${g.datasetColumns}">
                        <td th:text="${r.id}">#Id</td>
                        <td th:text="${r.name}">Column name</td>
                        <td th:text="${r.description}">Column description</td>
                        <td><a class="pure-button pure-button-primary" th:href="${'/launchpad/dataset-column-edit/' + r.id}">Edit</a></td>
                        <td><a class="pure-button pure-button-primary" th:href="${'/launchpad/dataset-column-delete/' + r.id}">Delete</a></td>
                        <td>
                            <a th:if="${ (not gIterStatus.first) && rIterStatus.first && (g.datasetColumns.size()>1 || r.lastColumn) }" class='pure-button pure-button-primary'
                               th:href="${'/launchpad/dataset-column-move-prev-group/' + r.id}">To prev group</a>
                            <a th:if="${ (not gIterStatus.last) && rIterStatus.last && g.datasetColumns.size()>1}" class='pure-button pure-button-primary'
                               th:href="${'/launchpad/dataset-column-move-next-group/' + r.id}">To next group</a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </td>
        </tr>
        </tbody>
    </table>

    <p></p>
    <p></p>
    <p></p>
    <h2 class="widget-header">Upload .csv file and create definition</h2>
    <p></p>

    <!--
        class="pure-form pure-form-stacked"
    -->
    <form class="pure-form" action="#" method="post" enctype="multipart/form-data" th:method="POST" th:action="@{/launchpad/dataset-group-from-file}">
        <input type="hidden" th:name="id" th:value="${result.dataset.id}"/>
        <fieldset>

            <label for="uploadFile">CSV file</label>
            <input id="uploadFile" placeholder="Choose File" th:disabled="disabled" th:width="200"/>
            <div class="fileUpload pure-button pure-button-primary">
                <span>Upload</span>
                <input name="file" id="uploadBtn" type="file" class="upload">
            </div>
            <span class="pure-form-message">This is a required field.</span>
        </fieldset>
        <p></p>
        <fieldset>
            <label for="is_header">Is the first line the header?</label>
            <input name="is_header" id="is_header" type="checkbox" placeholder="checkbox" >
<!--
            <span class="pure-form-message">This is a required field.</span>
-->
        </fieldset>
        <fieldset>
            <label for="is_header">Does this file use for definition only?</label>
            <input name="is_definition_only" id="is_definition_only" type="checkbox" placeholder="checkbox" >
            <span class="pure-form-message">If is_definition_only==true, then this dataset won't be registered as dataset.</span>
        </fieldset>
        <p></p>
        <button type="submit" class="pure-button pure-button-primary">Create definition</button>
    </form>

    <script>
        document.getElementById("uploadBtn").onchange = function () {
            document.getElementById("uploadFile").value = this.value;
        };
    </script>


    <p></p>
    <p></p>
    <p></p>
    <h2 class="widget-header">Back to dataset's section</h2>
    <p></p>
    <a class="pure-button pure-button-primary" href="#" th:href="${'/launchpad/datasets'}">Back to Datasets</a>

</div>
